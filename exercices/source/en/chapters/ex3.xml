<?xml version="1.0" encoding="UTF-8"?>
<chapter xml:lang="en" xmlns="http://docbook.org/ns/docbook" version="5.0"
	xmlns:xi="http://www.w3.org/2001/XInclude">
	<title>Exercise: Dynamically controlling the process flow with data</title>
	
	<section>
		<title>Goal</title>
		<para>The goal of this exercise is to extend the existing process by adding a dynamic validation for the leave request.
		This will be achieved with the use of an exclusive gateway which will lead one of two possible execution paths: one for the approved request and one for the rejected request.</para>
	</section>
	
	<section>
		<title>Instructions overview</title>
		<para>Duplicate the process diagram from the previous exercise to create a 3.0 version.</para>
		<para>Modify the diagram to add the following elements after the "Validate request" task:</para>
		<itemizedlist mark='bullet'>
			<listitem><para>an exclusive gateway named "Is approved?"</para></listitem>
			<listitem><para>a service task named "Notify request approved"</para></listitem>
			<listitem><para>a terminate end event named "End - Request rejected"</para></listitem>
			<listitem><para>a service task named "Notify request rejected"</para></listitem>
			<listitem><para>a terminate end event named "End - Request approved"</para></listitem>
		</itemizedlist>
		<para>Configure the transitions going out the exclusive gateway so that they control dynamically the process flow based on process data.</para>
	</section>
	
	<section>
		<title>Step by step instructions</title>
		<orderedlist>
			<listitem><para><emphasis role="bold">Duplicate the process diagram from the previous exercise to create a 3.0 version.</emphasis></para></listitem>
			<listitem>
				<para><emphasis role="bold">Remove the end event.</emphasis></para>
				<para>Select the event from the diagram and hit "delete" on your keyboard.</para>
			</listitem>
			<listitem>
				<para><emphasis role="bold">Add an exclusive gateway named "Is approved?" next to the human task "Validate request".</emphasis></para>
				<para>Select the "Validate request" task, perform a drag and drop from the gateway contextual icon.</para>
				<para>
					<mediaobject>
						<imageobject>
							<imagedata scalefit="1" width="100%" contentdepth="100%" align="center" format="png" fileref="resources/ex3_01.png" />
						</imageobject>
					</mediaobject>
				</para>
				<para>Once you have created the gateway, use the context "tool" icon (1) to change its type to "Exclusive" (2).</para>
				<para>
					<mediaobject>
						<imageobject>
							<imagedata scalefit="1" width="100%" contentdepth="100%" align="center" format="png" fileref="resources/ex3_02.png" />
						</imageobject>
					</mediaobject>
				</para>
				<para>Rename the gateway into "Is approved?".</para>
			</listitem>
			<listitem><para><emphasis role="bold">Create a service task named "Notify request approved" after the gateway.</emphasis></para></listitem>
			<listitem><para><emphasis role="bold">Add an end event named "End - Request approved" next to the newly added service task.</emphasis></para></listitem>
			<listitem><para><emphasis role="bold">Create a service task named "Notify request rejected" after the gateway.</emphasis></para></listitem>
			<listitem><para><emphasis role="bold">Add an end event named "End - Request rejected" next to the newly added service task.</emphasis></para></listitem>
			<listitem>
				<para><emphasis role="bold">Name the two transitions going out of the gateway</emphasis></para>
				<para>The transition leading to the "Notify request approved" task should be named "Yes" and the other "No".</para>
			</listitem>
			<listitem>
				<para><emphasis role="bold">Configure condition on the "Yes" transition to use the "isApproved" attribute of the "request" BDM.</emphasis></para>
				<para>Select the transition and click on the pencil icon next to the "Condition" dropdown to open the expression editor.</para>
				<para>In the expression editor, select "Java" as the expression type, select the "request" variable and the "isApproved" method.</para>
				<para>
					<mediaobject>
						<imageobject>
							<imagedata scalefit="1" width="100%" contentdepth="100%" align="center" format="png" fileref="resources/ex3_03.png" />
						</imageobject>
					</mediaobject>
				</para>
			</listitem>
			<listitem>
				<para><emphasis role="bold">Set the "No" transition as the default flow.</emphasis></para>
				<para>Select the "No" transition and check the "Default flow" property.</para>
			</listitem>
			<listitem>
				<para><emphasis role="bold">Validate the diagram.</emphasis></para>
				<para>Once the transition conditions are properly set, you can re-validate the process diagram.
				To do so, navigate to the "Validation status" tab and click on "refresh".
				You may safely ignore the 3 warnings related to the UI Designer.</para>
			</listitem>
			<listitem>
				<para><emphasis role="bold">Make sure that your diagram matches this:</emphasis></para>
				<para>
					<mediaobject>
						<imageobject>
							<imagedata scalefit="1" width="100%" contentdepth="100%" align="center" format="png" fileref="resources/ex3_04.png" />
						</imageobject>
					</mediaobject>
				</para>
			</listitem>
			<listitem>
				<para><emphasis role="bold">Execute twice the process to test the different paths.</emphasis></para>
				<para>Warning: do not hit twice the "Run" button as this would redeploy the process and clear the history.
				In order to create the second process instance, you will need to navigate in the Bonita Portal.</para>
				<para>To do so, navigate to the "Processes" menu (A) and select the "Leave request" process definition with version 3.0 (B) and click on "Start" (C).</para>
				<para>
					<mediaobject>
						<imageobject>
							<imagedata scalefit="1" width="100%" contentdepth="100%" align="center" format="png" fileref="resources/ex3_05.png" />
						</imageobject>
					</mediaobject>
				</para>
			</listitem>
			<listitem>
				<para><emphasis role="bold">Check that the process is correctly executed in the Portal administration interface.</emphasis></para>
				<para>In the Portal, switch to the "Administrator" profile with the top right dropdown.</para>
				<para>
					<mediaobject>
						<imageobject>
							<imagedata scalefit="1" width="100%" contentdepth="100%" align="center" format="png" fileref="resources/ex3_06.png" />
						</imageobject>
					</mediaobject>
				</para>
				<para>Navigate to the "BPM / Cases" menu (A) then, switch to the "Archived cases" tab (B) and click on the "..." link in the action column (C) to view the case details.</para>
				<para>
					<mediaobject>
						<imageobject>
							<imagedata scalefit="1" width="100%" contentdepth="100%" align="center" format="png" fileref="resources/ex3_07.png" />
						</imageobject>
					</mediaobject>
				</para>
				<para>Check the "Done tasks" section to validate the process execution:</para>
				<para>
					<mediaobject>
						<imageobject>
							<imagedata scalefit="1" width="100%" contentdepth="100%" align="center" format="png" fileref="resources/ex3_08.png" />
						</imageobject>
					</mediaobject>
				</para>
			</listitem>
		</orderedlist>
	</section>
</chapter>

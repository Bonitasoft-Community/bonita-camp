<?xml version="1.0" encoding="UTF-8"?>
<chapter xml:lang="fr" xmlns="http://docbook.org/ns/docbook" version="5.0"
	xmlns:xi="http://www.w3.org/2001/XInclude">
	<title>Exercice : Contrôle dynamique du flux d'exécution grâce aux données</title>

	<section>
		<title>Objectif</title>
		<para>L'objectif de cet exercice est d'enrichir le processus existant en ajoutant la gestion dynamique de la validation de la demande de congés.
		Ceci sera réalisé à l'aide d'une porte logique exclusive donnant accès à deux flux d'exécutions permettant de gérer le refus ou l'approbation de la demande.</para>
	</section>

	<section>
		<title>Instructions résumées</title>
		<para>Dupliquer le diagramme de processus de l'exercice précédent pour créer une version 3.0.</para>
		<para>Modifier le diagramme pour placer les éléments suivants à la suite de l'étape "Valider demande" :</para>
		<itemizedlist mark='bullet'>
			<listitem><para>une porte exclusive "Demande approuvée ?"</para></listitem>
			<listitem><para>une tâche automatique "Notifier approbation"</para></listitem>
			<listitem><para>un événement de terminaison "Fin - Demande approuvée"</para></listitem>
			<listitem><para>une tâche automatique "Notifier refus"</para></listitem>
			<listitem><para>un événement de terminaison "Fin - Demande refusée"</para></listitem>
		</itemizedlist>
		<para>Configurer les transitions en sortie de la porte exclusive pour diriger dynamiquement le flux d'exécution du processus en fonction des données du processus.</para>
	</section>

	<section>
		<title>Instructions pas à pas</title>
		<orderedlist>
			<listitem><para><emphasis role="bold">Dupliquer le diagramme de processus de l'exercice précédent pour créer une version 3.0.</emphasis></para></listitem>
			<listitem>
				<para><emphasis role="bold">Supprimer l'événement de terminaison.</emphasis></para>
				<para>Sélectionner l'évènement dans le diagramme et appuyer sur la touche "Suppr" du clavier.</para>
			</listitem>
			<listitem>
				<para><emphasis role="bold">Ajouter une porte exclusive "Demande approuvée ?" à la suite de la tâche "Valider demande".</emphasis></para>
				<para>Sélectionner la tâche "Valider demande", effectuer un glisser-déplacer à partir de l'icône contextuel de porte logique.</para>
				<para>
					<mediaobject>
						<imageobject>
							<imagedata scalefit="1" width="100%" contentdepth="100%" align="center" format="png" fileref="resources/ex3_01.png" />
						</imageobject>
					</mediaobject>
				</para>
				<para>Une fois la porte créée, utiliser l'icône contextuel "boîte à outils" (1) pour changer son type en "Exclusif" (2).</para>
				<para>
					<mediaobject>
						<imageobject>
							<imagedata scalefit="1" width="100%" contentdepth="100%" align="center" format="png" fileref="resources/ex3_02.png" />
						</imageobject>
					</mediaobject>
				</para>
				<para>Renommer la porte en "Demande approuvée ?".</para>
			</listitem>
			<listitem><para><emphasis role="bold">Créer une tâche automatique "Notifier approbation" à partir de la porte logique.</emphasis></para></listitem>
			<listitem><para><emphasis role="bold">Ajouter un événement de terminaison "Fin - Demande approuvée" à la suite de la tâche automatique "Notifier approbation".</emphasis></para></listitem>
			<listitem><para><emphasis role="bold">Créer une tâche automatique "Notifier refus" à partir de la porte logique.</emphasis></para></listitem>
			<listitem><para><emphasis role="bold">Ajouter un événement de terminaison "Fin - Demande refusée" à la suite de la tâche automatique "Notifier refus".</emphasis></para></listitem>
			<listitem>
				<para><emphasis role="bold">Nommer les 2 transitions entre la porte logique et les étapes automatiques</emphasis></para>
				<para>La transition menant à l'étape "Notifier approbation" se nommera "Oui" et l'autre "Non".</para>
			</listitem>

			<listitem>
				<para><emphasis role="bold">Configurer la condition sur la transition "Oui" à partir de l'attribut "estApprouvee" du BDM "demande".</emphasis></para>
				<para>Sélectionner la transition et cliquer sur l'icône crayon à côté du champ "Condition" pour ouvrir l'éditeur d'expression.</para>
				<para>Dans l'éditeur d'expression, sélectionner "Java" comme type d'expression, sélectionner la variable "demande" et la méthode "isEstAprouvee".</para>
				<para>
					<mediaobject>
						<imageobject>
							<imagedata scalefit="1" width="100%" contentdepth="100%" align="center" format="png" fileref="resources/ex3_03.png" />
						</imageobject>
					</mediaobject>
				</para>
			</listitem>
			<listitem>
				<para><emphasis role="bold">Configurer la transition "Non" en tant que flux par défaut.</emphasis></para>
				<para>Sélectionner la transition "Non" et cocher la case "Flux par défaut".</para>
			</listitem>
			<listitem>
				<para><emphasis role="bold">Déclencher la validation du diagramme.</emphasis></para>
				<para>Maintenant que les conditions sont correctement configurées sur les transitions il est possible de relancer la validation.
				Naviguer dans l'onglet "Statut de validation" et cliquer sur "Rafraîchir". Vous pouvez ignorer les trois messages d'avertissement liés au UI designer.</para>
			</listitem>
			<listitem>
				<para><emphasis role="bold">Vérifier que le diagramme ressemble à ceci :</emphasis></para>
				<para>
					<mediaobject>
						<imageobject>
							<imagedata scalefit="1" width="100%" contentdepth="100%" align="center" format="png" fileref="resources/ex3_04.png" />
						</imageobject>
					</mediaobject>
				</para>
			</listitem>
			<listitem>
				<para><emphasis role="bold">Exécuter deux fois le processus pour tester les différents chemins.</emphasis></para>
				<para>Attention : ne pas cliquer une deuxième fois sur le bouton "Lancer", cela aurait pour effet de redéployer le processus
				et donc de supprimer les instances existantes. Pour créer la seconde instance, il faut naviguer dans le portail.</para>
				<para>Dans le portail, naviguer dans le menu "Processus" puis sélectionner la définition de processus "Demande de congés" en version 3.0
				et cliquez sur "démarrer".</para>
			</listitem>
			<listitem>
				<para><emphasis role="bold">Vérifier le bon déroulement du processus dans l'interface d'administration du portail</emphasis></para>
				<para>Une fois dans le portail, changer de profil dans le coin supérieur droit pour passer en d'"Utilisateur" à "Administrateur".</para>
				<para>
					<mediaobject>
						<imageobject>
							<imagedata scalefit="1" width="100%" contentdepth="100%" align="center" format="png" fileref="resources/ex3_06.png" />
						</imageobject>
					</mediaobject>
				</para>
				<para>Naviguer dans le menu "BPM / Cas" (A) puis sélectionner l'onglet "Cas archivés" (B) et cliquer sur le lien "..." dans la colonne action (C) pour visualiser le détail d'un cas.</para>
				<para>
					<mediaobject>
						<imageobject>
							<imagedata scalefit="1" width="100%" contentdepth="100%" align="center" format="png" fileref="resources/ex3_07.png" />
						</imageobject>
					</mediaobject>
				</para>
				<para>Vérifier les "Tâches terminées" pour valider le bon déroulement du processus :</para>
				<para>
					<mediaobject>
						<imageobject>
							<imagedata scalefit="1" width="100%" contentdepth="100%" align="center" format="png" fileref="resources/ex3_08.png" />
						</imageobject>
					</mediaobject>
				</para>
			</listitem>
		</orderedlist>
	</section>
</chapter>
